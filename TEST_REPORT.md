# Test Report - FinChronicle Test Suite

## Test Run Information

**Date:** Generated dynamically from `test-metadata.json`
**App Version Tested:** See `test-metadata.json` for latest tested version
**Test Framework:** Vitest (unit/integration) + Playwright (E2E)

## Version Tracking

The test suite now automatically tracks which version of the main app it's testing:

- **Extraction Script**: Reads `APP_VERSION` from `app.js`
- **Metadata File**: `test-metadata.json` contains:
  - App version tested
  - Timestamp of extraction
  - Number of functions successfully extracted
  - Test success status

## Test Coverage

### Unit Tests (76 tests)

#### Version Tracking Tests ✅
- Verifies APP_VERSION is exported and valid
- Ensures testing v3.7.1 or higher

#### Formatters (15 tests) ✅
- `formatCurrency()` - Currency symbol formatting
- `formatNumber()` - Number formatting with separators
- `formatDate()` - Date display formatting
- `formatMonth()` - Month display formatting

#### Parsers (18 tests) ✅
- `parseCSV()` - CSV parsing with various formats
- `normalizeDate()` - Date normalization from multiple formats
- `monthNameToNumber()` - Month name to number conversion
- `findHeaderIndex()` - CSV header detection

#### Validators (25 tests) ✅
- `normalizeImportedCategory()` - Category detection from descriptions
- `getCurrencySymbol()` - Currency symbol retrieval
- `getCurrency()` - Currency code retrieval

#### Trend Calculations (18 tests) ✅ **NEW in v3.7.0**
- `calculateMoMDelta()` - Month-over-month percentage change
  - Positive/negative changes
  - Zero previous month (first month scenario)
  - Both months zero
  - Null/undefined handling
  - Negative value calculations
- `calculateExpensePercentage()` - Expense as % of income
  - Normal calculations
  - Expenses > income (overspending)
  - Zero income/expense handling
  - Decimal precision
  - Edge cases

> **Note:** `getPreviousMonth()` and `getMonthTotals()` rely on global state or timezone-specific Date conversions, so they're tested via E2E tests instead of unit tests.

### Integration Tests
*Future: Database interactions, localStorage operations*

### E2E Tests (Playwright)
- Transaction CRUD operations
- CSV import/export
- Filtering and search
- **NEW:** Summary card click navigation (v3.7.0)
- **NEW:** Trend indicator display (v3.7.0)

## v3.7.1 Test Updates

### New Tests Added
1. **Version Tracking Tests** - Ensures test suite knows what version it's testing
2. **Trend Calculation Tests** - 18 new tests for MoM delta and expense percentage calculations
3. **Typography Tests** - E2E tests verify monospace fonts are applied to numbers

### Extraction Improvements
- Script now extracts APP_VERSION from main app
- Generates `test-metadata.json` with version and timestamp
- Extracts 15/15 functions successfully (added 4 new trend functions)

## How to View Test Results

### Check Latest Tested Version
```bash
cat test-metadata.json
```

Example output:
```json
{
  "appVersion": "3.7.1",
  "testedAt": "2026-02-07T09:43:25.068Z",
  "extractedFunctions": 15,
  "totalFunctions": 15,
  "success": true
}
```

### Run Tests
```bash
# Run all tests with version extraction
npm test

# Unit tests only
npm run test:unit

# E2E tests only
npm run test:e2e

# With coverage report
npm run test:coverage
```

## Test Success Criteria

✅ **All unit tests passing (76/76)**
✅ **Version tracking working**
✅ **Extraction successful (15/15 functions)**
✅ **Test metadata generated**

## Future Enhancements

- [ ] Add E2E tests for clickable summary tiles
- [ ] Add E2E tests for trend indicator display
- [ ] Add visual regression tests for typography changes
- [ ] Add performance benchmarks
- [ ] Add accessibility tests (WCAG AA compliance)

## Troubleshooting

### Version Mismatch
If tests fail due to API changes:
1. Check `test-metadata.json` for tested version
2. Compare with `../finance-tracker/app.js` APP_VERSION
3. Run `npm run extract` to update extracted functions
4. Re-run tests

### Function Not Found
If extraction fails to find a function:
1. Verify function exists in `../finance-tracker/app.js`
2. Check function naming in `scripts/extract-functions.js`
3. Ensure function uses `function` keyword (not arrow function or const)
4. Run `npm run extract` to regenerate

---

**Generated by:** FinChronicle Test Suite
**Repository:** github.com/kiren-labs/finance-tracker-tests
